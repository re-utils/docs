---
title: API
description: udic library API.
---

import { Tabs, TabItem } from '@astrojs/starlight/components';

#### `di.service()`
- Parameters:
  + `<T>` - Service identifier type.
  + `name: T` - Service identifier.
- Returns `<K>() => Service<T, K> & K`

Create a service.

Example usage:
```ts
import * as di from 'udic';

// di.Service<'db', DB> & 'db'
const db = di.service('db')<DB>();
```

#### `di.derive()`
- Parameters:
  + `<const T extends di.Dependency[]>` - Compute dependency list type.
  + `<const R>` - Compute result type.
  + `deps: T` - Compute dependency list.
  + `f: (...args: { [K in keyof T] : di.InferResult<T[K]> }) => R` - The function to compute the result from provided dependencies.
- Returns `Compute<InferDependency<T[number]>, R>` - A function that requires the implementations of the provided dependencies to execute.

Example usage:
<Tabs>
  <TabItem label="services.ts" icon="seti:typescript">
    ```ts
    import { service } from 'udic';
    import { DatabaseSync } from 'node:sqlite';

    export const db = service('db')<DatabaseSync>();
    ```
  </TabItem>
  <TabItem label="routes/posts.ts" icon="seti:typescript">
    ```ts
    import { derive } from 'udic';
    import { router, handle } from '@mapl/web';

    import { db } from '../services.ts';

    export default derive(
      [db],
      (db) => {
        const getPosts = db.prepare('SELECT * FROM posts');

        // Create a sub-router
        return router.init([], [
          handle.get('/all', () => getPosts.all(), { type: 'json' })
        ]);
      }
    );
    ```
  </TabItem>
  <TabItem label="server.ts" icon="seti:typescript">
    ```ts
    import { derive } from 'udic';
    import { DatabaseSync } from 'node:sqlite';
    import { router, compile } from '@mapl/web';

    import posts from './routes/posts.ts';

    const app = derive(
      [posts],

      // Register the sub-router
      (posts) => router([], [], {
        '/posts': posts
      })
    )({
      // Use an in-memory database
      db: new DatabaseSync(':memory:')
    });

    // Export the fetch function (Works for Bun, Cloudflare Workers, ...)
    export default {
      fetch: compile(app)
    };
    ```
  </TabItem>
</Tabs>
