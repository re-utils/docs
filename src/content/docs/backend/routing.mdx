---
title: Routing
description: Basic routing in mapl/web
---

import { Tabs, TabItem } from '@astrojs/starlight/components';

Here's a `@mapl/web` API with a route that simply return `Hi`.
```ts
// server.js
import { router, handle } from '@mapl/web';
import { compileToHandlerSync } from '@mapl/web/compiler/jit';

const app = router([], [
  handle.get('/', () => new Response('Hi'))
]);

export default {
  fetch: compileToHandlerSync(app)
};
```

Run the server with [`srvx`](https://srvx.h3.dev/guide/cli) CLI:
<Tabs syncKey='packageManager'>
  <TabItem label='npm' icon='seti:npm'>
    ```sh showLineNumbers=false
    npx srvx --port=8080 server.js
    ```
  </TabItem>
  <TabItem label='bun' icon='bun'>
    ```sh showLineNumbers=false
    bun x --bun srvx --port=8080 server.js
    ```
  </TabItem>
  <TabItem label='pnpm' icon='pnpm'>
    ```sh showLineNumbers=false
    pnpx srvx --port=8080 server.js
    ```
  </TabItem>
  <TabItem label='yarn' icon='seti:yarn'>
    ```sh showLineNumbers=false
    yarn dlx srvx --port=8080 server.js
    ```
  </TabItem>
</Tabs>

Navigate to http://localhost:8080, you should see `Hi` as the result.

## Route patterns
`@mapl/web` supports these patterns:
```ts
// From highest to lowest priority
'/static' // Static routes
'/user/*/dashboard' // Capture one path segment
'/search/**' // Capture all path segments after '/search'
```

Example usage:
```ts
const app = router([], [
  handle.get(
    '/',
    () => new Response('Hi')
  ), // '/' => 'Hi'

  handle.get(
    '/user/*',
    (id) => new Response('User: ' + id)
  ), // '/user/reve' => 'User: reve'

  handle.get(
    '/search/**',
    (rest) => new Response('Search results for: ' + rest)
  ) // '/search/a/b' => 'Search results for: a/b'
]);
```

## Response handler
Response handler handles convert result type from route handler to a `Response` object.
```ts
const app = router([], [
  handle.get('/', () => 'Hi', {
    type: handle.text
  }), // '/' => 'Hi'
]);
```

Built-in response handlers:
```ts
handle.text; // Accepts BodyInit
handle.json; // Accepts any type and serialize to JSON
handle.html; // Accepts BodyInit and automatically set HTML headers
```

## Subroutes
Subroutes can be used to declare multiple routes with the same prefix.
```ts
const user = router([], [
  handle.get('/profile', () => ...),
  handle.get('/login', () => ...)
])

const app = router([], [
  handle.get('/', () => ...)
], {
  // register as /user/profile and /user/login
  '/user': user
});
```
